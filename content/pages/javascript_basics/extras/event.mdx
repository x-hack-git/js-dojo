---
title: イベントについて
slug: "/javascript_basics/extras/event"
---

イベントについて解説します。

JavaScriptプログラムは、「ユーザーのマウス操作」や、「キーボード操作」、「特定の処理の開始/終了」などのタイミングで**任意のプログラム**を実行することができます。

ウェブアプリケーションプログラミングでは、ボタンの**クリック**、要素の**ドラッグ&ドロップ**、などがよく使われる **「イベント」** です。

**クリック**、**ドラッグ&ドロップ**以外にも、**通信**が開始・終了した時、画像の読み込みが開始・終了した時、ネットワークに繋がった時など様々な「イベント」に応じて、特定の処理を「発火」させることができます。

事前に定義したプログラムが特定のタイミングで実行されることを **「発火する」** と表現することがあります。(プログラムが発火する、イベントが発火する、関数が発火する etc…)

## 用語集

- イベントオブジェクト
- 発火
- BIOS
- マザーボード
- マウス操作
- キーボード操作
- CUI(キャラクターユーザーインターフェース/Character User Interface)
- GUI(グラフィカルユーザーインターフェース/[Graphical User Interface](https://en.wikipedia.org/wiki/en:Graphical_User_Interface))
- MS-DOS / MacOS / Windows / Linux / iOS / Android

## JavaScriptのイベントの解説の前に

マウスやキーボードの入力イベントの前に、その大元の**マウスやキーボードがどうブラウザアプリケーションと繋がっているか**を見ていきたいと思います。

そのためには、OSの仕組みを簡単に説明する必要があるので、まずは簡単にOSについて復習しましょう！

![](~/assets/images/event_01.png)

## OS(Operating System)もアプリケーションである

MS-DOS / MacOS / Windows / Linux / iOS / Android など様々なOSがこの世にあることは皆さんご存知だと思います。当然のことながら、OSもソフトウェアであり C、C++、Java などのプログラム言語で記述されています。(つまり、皆さんも勉強を続けていけば、自分でOSを作成することが可能ということです)

## 黒い画面のコンピュータ

さあ、少し時代を遡って、一般向けのコンピュータが登場して間もない頃の話をしましょう。

まだパソコンの画面が白黒表示で、ディスプレイに文字を表示するのが精一杯だった時代の話です。大昔のように感じますが、ほんの三十数年程前の話です。

当時のコンピュータは、ハードウェアの性能もOSの機能も今より貧弱だったため、アプリケーションを同時に立ち上げることができませんでした。Windowsが登場する以前は、コンピューターには**一度に一つの仕事しかできない**のが常識でした。

一つしかアプリケーションを起動できませんから

1. パソコンで音楽を聞きながら
2. 画像加工ソフトで作った画像を
3. エクセルにコピーして貼り付ける

なんてことは出来なかったのです。

初期のパソコンはコマンド(文字入力)でコンピュータに命令をし、実行キーを押すと、結果が黒い画面にずらずらと映し出されるような代物で、今のようにマウスでの操作もできませんでした。マウスが登場するのはもう少し後の時代です。

![](~/assets/images/event_02.png)

このようなキーボードのみで操作するインターフェースは**CUI**と呼ばれます。CUIは **Character User Interface** の頭文字をとったもので、テキストによって操作するインターフェースを指します。

ちなみにインターフェースとは「境界面」のことで、コンピュータとユーザーのやりとりする部分のことです。

マウスを使ってクリックやドラッグ&ドロップで直感的に操作できるインターフェースのことはGUI **Graphical User Interface** と呼ばれます。皆さんが普段お使いのパソコンはほとんどがGUI インターフェースのものだと思います。

Linux などのサーバー専用OSは CUI のものが多いです。それと、MacやVScodeの**ターミナル画面**はCUIですね！

## OSの役割とは？

話を戻します。OSの役割は一体何でしょうか？

簡単に言ってしまうと、ハードウェア(CPU/メインメモリ/キーボード/マウス/HDD/通信デバイス/液晶ディスプレイ/ファン)とアプリケーションの**データの橋渡し**です。

## BIOS(バイオス)

CPU、メモリ、ハードディスク、グラフィックボード、キーボード、マウス、CD/DVD、電源など周辺機器は全て**マザーボード**に接続をして、制御されています。

むき出しのマザーボードにそれらの機器を接続すれば普通にパソコンとして使うことができます。

これらの制御を担当する、簡単なOS(プログラム）が最初からマザーボード上に組み込まれています。これをBIOS（バイオス）といいます。

![](~/assets/images/event_03.jpeg)

BIOSがWindowsやMacOSなどを起動してくれています。近代的なコンピュータだとこれが存在しない場合もあり、OSがBIOSの役割をになっている場合もあるそうです。

## キーボードを触った時に何が起きているか？

キーボードはパソコン本体と接続されています。皆さんがテキストエディタやブラウザで`A`のキーを押した時、一体全体**どういう仕組みで画面にAという文字が表示されるのか**考えたことはあるでしょうか？

パソコン上でテキストエディタ、ブラウザ、メールアプリ、チャットアプリを同時に複数開いていいても、**キーボードの入力を受け付けるのはそのうちのアクティブになっているアプリケーションだけ**だと思います。

一体どういう仕組みでしょう？

キーボードのキーが押されてからアプリケーションの画面に文字が出力されるまでの動作原理を正確に説明しようとすると、本筋から大きく外れてしまうためざっくりと簡単に説明してみたいと思います。

**非常にざっくり**なので、正確なことが知りたい場合は各自で調べてくださいね。

## キーボードの`A`が押された時の流れを知る

1. **OSはキーボードの入力信号を常に監視し受け取れるように常時スタンバイしている**
2. ユーザーがキーボードの`A`のキーを押す
3. キーボードから`A`のキーを押したという信号がマザーボードを経由してOSに伝えられる
4. OSがキーボードが発した信号をキャッチする
5. OSは現在アクティブなアプリケーション(ブラウザやテキストエディタなど)を検出し、そのアプリケーションに`A`のキーが押されたことを伝える
6. アプリケーションが`A`というキーが押された時の処理を実行する

ざっくりこんな流れになっています。
※マウスを動かす、クリックするなどの場合も同様です

キーボードを一つ打つだけでも、その裏側では物凄い処理が積み重なっているのです。

## マウスを動かした時、一体何が起きている？

マウスやトラックパッドの場合は、

右クリックか？
左クリックか？
ホイールが動いたのか？
マウスはどのくらいの速度でどの方向に何秒間動いたのか？

などの情報をOSが受け取り、マウスのポインタを動かしています(そしてカーソルが動いて見えるように瞬時に画面が書き換えられています)。

そしてクリックが実行された時は、どの位置(座標)でマウスのボタンがクリックされたかという情報がOSに伝わります。

ここで、OS側はアプリケーションがどんなボタン要素を持っているかなどは基本的に一切把握していません。あくまでも、OSがアプリケーションに伝える情報は「どの位置(座標)でマウスがクリックされたか？」だけです。

アプリケーション側は、画面に表示されたボタンなどの要素がどの位置にあるか？というデータを持っており、例えば ボタンA が

```
{ x: 0, y:0, width:200, height:100 }
```

に配置されているとすると、クリックした座標が

```
x: 0 ~ 200
y: 0 ~ 100
```

の範囲内であれば、ボタンAが押されたと分かりますよね

こういう仕組みで、**アプリケーションはどの要素がクリックされたかどうかを知ることができる**わけです。

## イベントオブジェクト

はい、長かったですね。マウスやキーボードのイベントがどこから流れてくるのか、上流まで遡ってみてきました。

ここまでが「キーボード入力」や「クリック」などをアプリケーションがどのように検知し、どの要素がクリックされたのか判定する仕組みの部分です。

そして、JavaScriptの場合、ユーザーが実行したマウス操作やキーボード操作の情報は、**イベントオブジェクト**に格納されるようになっているのです。

どのページでもいいので、下記のJavaScriptをconsoleで実行し、クリックイベントを登録してから、ページの適当な箇所をクリックしてイベントを発火させてみてください。

そして、**event** にどんな情報が入っているかみてみましょう

```
// 書き方 その1
document.getElementsByTagName("body")[0].onclick = btnClick
　
function btnClick(event){
    // ↓↓↓みんなの疑問↓↓↓
    // この `event` はどこからきたのか？
    console.log(event)
}
```

```
// 書き方 その2
var body = document.getElementsByTagName("body")[0]
body.addEventListener("click", btnClick, false);
　
function btnClick(event){
    // ↓↓↓みんなの疑問↓↓↓
    // この `event` はどこからきたのか？
    console.log(event)
}
```


### eventオブジェクトの中身

![](~/assets/images/event_04.png)

## イベントとして登録した関数の最初の引数には、**必ずイベントオブジェクトが渡される**ようになっている

これだけをルールとして覚えておくと良いと思います。引数の名前は慣例的に `event` や `e` とすることが多いですが、通常の関数の引数と同様、**名前が変わっても問題はない**です。ただ、なるべくevent / e などの名前にしましょう。他の人が混乱するといけませんからね。

```
// どちらでもOK
// event と名付ける
function btnClick(event){ ... }
// e と名付ける
function btnClick(e){ ... }
```

## 課題

ボタンにイベントを登録しておいて、右半分と左半分で処理を分けるようなこともできます。
今回の課題としてチャレンジしてみてください！

## EventTarget.addEventListener() について

https://developer.mozilla.org/ja/docs/Web/API/EventTarget/addEventListener

```
target.addEventListener(type, listener[, options]);
target.addEventListener(type, listener[, useCapture]);
```

この **type** には**利用可能なイベントの名称**が入ります

```
click, mousemove, drag ... など多数
```

https://developer.mozilla.org/ja/docs/Web/Events


例1：第三引数はオプションなので省略

```
var button = document.getElementById("button")
button.addEventListener("click", ()=> { console.log("hello") });
```

例2：第三引数を明示

```
var button = document.getElementById("button")
button.addEventListener("click", func, false);
　
function func() {
    // 処理
}
```

例3：

```
var button = document.getElementById("button")
button.addEventListener("click", func, { capture: false, once: true});
　
function func() {
    // 処理
}
```

## addEventListenerのuseCaptureについて

クリックした座標に複数対象となる要素がある場合に、どういう処理をするかを規定します。デフォルトでは、一番上にある要素だけがクリックに反応します。

https://developer.mozilla.org/ja/docs/Web/API/EventTarget/addEventListener
